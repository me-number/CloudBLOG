<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <!-- 1. 核心：禁止缩放元标签 -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">

  <title>{% if page.title %}{{ page.title }}{% else %}{{ site.data.settings.title }}{% endif %}</title>
  <meta name='description' content='{% if page.description %}{{ page.description | strip_html | strip_newlines | truncate: 160 }}{% else %}{{ site.description }}{% endif %}'>

  <!-- 2. DNS 预解析：减少外部资源（如图标、字体）连接时间 -->
  <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
  <link rel="dns-prefetch" href="//fonts.googleapis.com">

  <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
  <link rel="alternate" type="application/rss+xml" title="{{ site.data.settings.title | escape }}" href="{{ "/feed.xml" | relative_url }}">

  <!-- 3. 性能优化：预加载 LCP 关键图片 -->
  {% if site.data.settings.logo %}
  <link rel="preload" as="image" href="{{ site.baseurl }}{{ site.data.settings.logo }}" fetchpriority="high">
  {% endif %}
  {% if page.image %}
  <link rel="preload" as="image" href="{{ page.image | relative_url }}" fetchpriority="high">
  {% endif %}

  <!-- 4. 解决“屏蔽渲染”警告：异步加载主 CSS，并内嵌关键样式 -->
  <style>
    /* 内嵌核心 CSS：确保背景颜色和基础结构瞬间显示，不等待 main.css 下载 */
    :root { --background-color: #ffffff; --heading-font-color: #000000; }
    [dark] { --background-color: #121212; --heading-font-color: #ffffff; }
    html, body { 
      background-color: var(--background-color); 
      margin: 0; padding: 0; 
      touch-action: pan-x pan-y; 
      -webkit-text-size-adjust: 100%; 
    }
    .header, .post-head { display: block; }
    /* 预留图片容器位置，防止布局偏移 */
    .post-image, .page-image { background: var(--background-alt-color, #eee); min-height: 250px; }
  </style>
  
  <!-- 使用 print 模式异步加载，加载完成后切换回 all。这是 2025 年最有效的非阻塞加载方式 -->
  <link rel="stylesheet" href="{{ '/css/main.css' | relative_url }}" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="{{ '/css/main.css' | relative_url }}"></noscript>

  <!-- 5. 主题色切换脚本 (内联执行，防止页面闪烁) -->
  <script>
    (function() {
      var theme = localStorage.getItem("theme");
      var config = "{{ site.data.settings.color_scheme }}";
      if (config === "auto" || config === "") {
        if (theme === "dark" || (!theme && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
          document.documentElement.setAttribute("dark", "");
          document.documentElement.classList.add('dark-mode');
        }
      } else if (config === "dark") {
        document.documentElement.setAttribute("dark", "");
        document.documentElement.classList.add('dark-mode');
      }
    })();
  </script>

  <!-- 6. 全平台禁止缩放脚本 -->
  <script defer>
    (function() {
      // 禁止键盘缩放
      document.addEventListener('keydown', function (e) {
        if ((e.ctrlKey || e.metaKey) && ['+', '-', '=', '0'].includes(e.key)) e.preventDefault();
      }, { passive: false });
      // 禁止滚轮缩放
      document.addEventListener('wheel', function (e) {
        if (e.ctrlKey || e.metaKey) e.preventDefault();
      }, { passive: false });
      // 禁止移动端手势
      document.addEventListener('touchstart', function (e) {
        if (e.touches.length > 1) e.preventDefault();
      }, { passive: false });
      // 禁止 iOS 双击缩放
      let lastTouch = 0;
      document.addEventListener('touchend', function (e) {
        const now = Date.now();
        if (now - lastTouch <= 300) e.preventDefault();
        lastTouch = now;
      }, false);
    })();
  </script>
</head>
